import{r as p,R as Q}from"./index-37ba2b57.js";import{s as se,l as M,o as x,S as ue,D as K,u as V,p as ne,c as xe,d as Y,R as ge,X as U,y as J,C as Re,a as ce}from"./open-closed-452e92a4.js";import{h as Oe,c as Ce,p as Ie,I as z,n as Se,o as y,r as he,b as Pe}from"./use-owner-127f86a6.js";import{s as Te}from"./use-resolve-button-type-39f07965.js";import{F as ye,u as $e,a as S,x as Ee}from"./use-tracked-pointer-a7a12abc.js";import{m as de,n as De}from"./platform-c0b4c731.js";function re(e,t){let[n,o]=p.useState(e),a=se(e);return M(()=>o(a.current),[a,o,...t]),n}function pe(e={},t=null,n=[]){for(let[o,a]of Object.entries(e))fe(n,be(t,o),a);return n}function be(e,t){return e?e+"["+t+"]":t}function fe(e,t,n){if(Array.isArray(n))for(let[o,a]of n.entries())fe(e,be(t,o.toString()),a);else n instanceof Date?e.push([t,n.toISOString()]):typeof n=="boolean"?e.push([t,n?"1":"0"]):typeof n=="string"?e.push([t,n]):typeof n=="number"?e.push([t,`${n}`]):n==null?e.push([t,""]):pe(n,t,e)}function we(e,t,n){let[o,a]=p.useState(n),u=e!==void 0,l=p.useRef(u),R=p.useRef(!1),v=p.useRef(!1);return u&&!l.current&&!R.current?(R.current=!0,l.current=u,console.error("A component is changing from uncontrolled to controlled. This may be caused by the value changing from undefined to a defined value, which should not happen.")):!u&&l.current&&!v.current&&(v.current=!0,l.current=u,console.error("A component is changing from controlled to uncontrolled. This may be caused by the value changing from a defined value to undefined, which should not happen.")),[u?e:o,x(d=>(u||a(d),t==null?void 0:t(d)))]}var Ae=(e=>(e[e.Open=0]="Open",e[e.Closed=1]="Closed",e))(Ae||{}),Fe=(e=>(e[e.Single=0]="Single",e[e.Multi=1]="Multi",e))(Fe||{}),Me=(e=>(e[e.Pointer=0]="Pointer",e[e.Other=1]="Other",e))(Me||{}),Le=(e=>(e[e.OpenCombobox=0]="OpenCombobox",e[e.CloseCombobox=1]="CloseCombobox",e[e.GoToOption=2]="GoToOption",e[e.RegisterOption=3]="RegisterOption",e[e.UnregisterOption=4]="UnregisterOption",e[e.RegisterLabel=5]="RegisterLabel",e))(Le||{});function te(e,t=n=>n){let n=e.activeOptionIndex!==null?e.options[e.activeOptionIndex]:null,o=Pe(t(e.options.slice()),u=>u.dataRef.current.domRef.current),a=n?o.indexOf(n):null;return a===-1&&(a=null),{options:o,activeOptionIndex:a}}let ke={1(e){var t;return(t=e.dataRef.current)!=null&&t.disabled||e.comboboxState===1?e:{...e,activeOptionIndex:null,comboboxState:1}},0(e){var t;if((t=e.dataRef.current)!=null&&t.disabled||e.comboboxState===0)return e;let n=e.activeOptionIndex;if(e.dataRef.current){let{isSelected:o}=e.dataRef.current,a=e.options.findIndex(u=>o(u.dataRef.current.value));a!==-1&&(n=a)}return{...e,comboboxState:0,activeOptionIndex:n}},2(e,t){var n,o,a,u;if((n=e.dataRef.current)!=null&&n.disabled||(o=e.dataRef.current)!=null&&o.optionsRef.current&&!((a=e.dataRef.current)!=null&&a.optionsPropsRef.current.static)&&e.comboboxState===1)return e;let l=te(e);if(l.activeOptionIndex===null){let v=l.options.findIndex(d=>!d.dataRef.current.disabled);v!==-1&&(l.activeOptionIndex=v)}let R=Ee(t,{resolveItems:()=>l.options,resolveActiveIndex:()=>l.activeOptionIndex,resolveId:v=>v.id,resolveDisabled:v=>v.dataRef.current.disabled});return{...e,...l,activeOptionIndex:R,activationTrigger:(u=t.trigger)!=null?u:1}},3:(e,t)=>{var n,o;let a={id:t.id,dataRef:t.dataRef},u=te(e,R=>[...R,a]);e.activeOptionIndex===null&&(n=e.dataRef.current)!=null&&n.isSelected(t.dataRef.current.value)&&(u.activeOptionIndex=u.options.indexOf(a));let l={...e,...u,activationTrigger:1};return(o=e.dataRef.current)!=null&&o.__demoMode&&e.dataRef.current.value===void 0&&(l.activeOptionIndex=0),l},4:(e,t)=>{let n=te(e,o=>{let a=o.findIndex(u=>u.id===t.id);return a!==-1&&o.splice(a,1),o});return{...e,...n,activationTrigger:1}},5:(e,t)=>({...e,labelId:t.id})},le=p.createContext(null);le.displayName="ComboboxActionsContext";function W(e){let t=p.useContext(le);if(t===null){let n=new Error(`<${e} /> is missing a parent <Combobox /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(n,W),n}return t}let ie=p.createContext(null);ie.displayName="ComboboxDataContext";function B(e){let t=p.useContext(ie);if(t===null){let n=new Error(`<${e} /> is missing a parent <Combobox /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(n,B),n}return t}function _e(e,t){return V(t.type,ke,e,t)}let Ne=p.Fragment;function Ve(e,t){let{value:n,defaultValue:o,onChange:a,form:u,name:l,by:R=(b,g)=>b===g,disabled:v=!1,__demoMode:d=!1,nullable:O=!1,multiple:I=!1,...r}=e,[i=I?[]:void 0,C]=we(n,a,o),[m,s]=p.useReducer(_e,{dataRef:p.createRef(),comboboxState:d?0:1,options:[],activeOptionIndex:null,activationTrigger:1,labelId:null}),$=p.useRef(!1),L=p.useRef({static:!1,hold:!1}),q=p.useRef(null),D=p.useRef(null),k=p.useRef(null),_=p.useRef(null),w=x(typeof R=="string"?(b,g)=>{let h=R;return(b==null?void 0:b[h])===(g==null?void 0:g[h])}:R),H=p.useCallback(b=>V(c.mode,{1:()=>i.some(g=>w(g,b)),0:()=>w(i,b)}),[i]),c=p.useMemo(()=>({...m,optionsPropsRef:L,labelRef:q,inputRef:D,buttonRef:k,optionsRef:_,value:i,defaultValue:o,disabled:v,mode:I?1:0,get activeOptionIndex(){if($.current&&m.activeOptionIndex===null&&m.options.length>0){let b=m.options.findIndex(g=>!g.dataRef.current.disabled);if(b!==-1)return b}return m.activeOptionIndex},compare:w,isSelected:H,nullable:O,__demoMode:d}),[i,o,v,I,O,d,m]),T=p.useRef(c.activeOptionIndex!==null?c.options[c.activeOptionIndex]:null);p.useEffect(()=>{let b=c.activeOptionIndex!==null?c.options[c.activeOptionIndex]:null;T.current!==b&&(T.current=b)}),M(()=>{m.dataRef.current=c},[c]),Oe([c.buttonRef,c.inputRef,c.optionsRef],()=>oe.closeCombobox(),c.comboboxState===0);let N=p.useMemo(()=>({open:c.comboboxState===0,disabled:v,activeIndex:c.activeOptionIndex,activeOption:c.activeOptionIndex===null?null:c.options[c.activeOptionIndex].dataRef.current.value,value:i}),[c,v,i]),ee=x(b=>{let g=c.options.find(h=>h.id===b);g&&A(g.dataRef.current.value)}),f=x(()=>{if(c.activeOptionIndex!==null){let{dataRef:b,id:g}=c.options[c.activeOptionIndex];A(b.current.value),oe.goToOption(S.Specific,g)}}),j=x(()=>{s({type:0}),$.current=!0}),E=x(()=>{s({type:1}),$.current=!1}),G=x((b,g,h)=>($.current=!1,b===S.Specific?s({type:2,focus:S.Specific,id:g,trigger:h}):s({type:2,focus:b,trigger:h}))),P=x((b,g)=>(s({type:3,id:b,dataRef:g}),()=>{var h;((h=T.current)==null?void 0:h.id)===b&&($.current=!0),s({type:4,id:b})})),F=x(b=>(s({type:5,id:b}),()=>s({type:5,id:null}))),A=x(b=>V(c.mode,{0(){return C==null?void 0:C(b)},1(){let g=c.value.slice(),h=g.findIndex(Z=>w(Z,b));return h===-1?g.push(b):g.splice(h,1),C==null?void 0:C(g)}})),oe=p.useMemo(()=>({onChange:A,registerOption:P,registerLabel:F,goToOption:G,closeCombobox:E,openCombobox:j,selectActiveOption:f,selectOption:ee}),[]),ve=t===null?{}:{ref:t},X=p.useRef(null),me=ne();return p.useEffect(()=>{X.current&&o!==void 0&&me.addEventListener(X.current,"reset",()=>{C==null||C(o)})},[X,C]),Q.createElement(le.Provider,{value:oe},Q.createElement(ie.Provider,{value:c},Q.createElement(xe,{value:V(c.comboboxState,{0:Y.Open,1:Y.Closed})},l!=null&&i!=null&&pe({[l]:i}).map(([b,g],h)=>Q.createElement(Ce,{features:Ie.Hidden,ref:h===0?Z=>{var ae;X.current=(ae=Z==null?void 0:Z.closest("form"))!=null?ae:null}:void 0,...ge({key:b,as:"input",type:"hidden",hidden:!0,readOnly:!0,form:u,name:b,value:g})})),U({ourProps:ve,theirProps:r,slot:N,defaultTag:Ne,name:"Combobox"}))))}let Ke="input";function Ue(e,t){var n,o,a,u;let l=z(),{id:R=`headlessui-combobox-input-${l}`,onChange:v,displayValue:d,type:O="text",...I}=e,r=B("Combobox.Input"),i=W("Combobox.Input"),C=J(r.inputRef,t),m=Se(r.inputRef),s=p.useRef(!1),$=ne(),L=x(()=>{i.onChange(null),r.optionsRef.current&&(r.optionsRef.current.scrollTop=0),i.goToOption(S.Nothing)}),q=function(){var f;return typeof d=="function"&&r.value!==void 0?(f=d(r.value))!=null?f:"":typeof r.value=="string"?r.value:""}();de(([f,j],[E,G])=>{if(s.current)return;let P=r.inputRef.current;P&&((G===0&&j===1||f!==E)&&(P.value=f),requestAnimationFrame(()=>{if(s.current||!P||(m==null?void 0:m.activeElement)!==P)return;let{selectionStart:F,selectionEnd:A}=P;Math.abs((A??0)-(F??0))===0&&F===0&&P.setSelectionRange(P.value.length,P.value.length)}))},[q,r.comboboxState,m]),de(([f],[j])=>{if(f===0&&j===1){if(s.current)return;let E=r.inputRef.current;if(!E)return;let G=E.value,{selectionStart:P,selectionEnd:F,selectionDirection:A}=E;E.value="",E.value=G,A!==null?E.setSelectionRange(P,F,A):E.setSelectionRange(P,F)}},[r.comboboxState]);let D=p.useRef(!1),k=x(()=>{D.current=!0}),_=x(()=>{$.nextFrame(()=>{D.current=!1})}),w=x(f=>{switch(s.current=!0,f.key){case y.Enter:if(s.current=!1,r.comboboxState!==0||D.current)return;if(f.preventDefault(),f.stopPropagation(),r.activeOptionIndex===null){i.closeCombobox();return}i.selectActiveOption(),r.mode===0&&i.closeCombobox();break;case y.ArrowDown:return s.current=!1,f.preventDefault(),f.stopPropagation(),V(r.comboboxState,{0:()=>{i.goToOption(S.Next)},1:()=>{i.openCombobox()}});case y.ArrowUp:return s.current=!1,f.preventDefault(),f.stopPropagation(),V(r.comboboxState,{0:()=>{i.goToOption(S.Previous)},1:()=>{i.openCombobox(),$.nextFrame(()=>{r.value||i.goToOption(S.Last)})}});case y.Home:if(f.shiftKey)break;return s.current=!1,f.preventDefault(),f.stopPropagation(),i.goToOption(S.First);case y.PageUp:return s.current=!1,f.preventDefault(),f.stopPropagation(),i.goToOption(S.First);case y.End:if(f.shiftKey)break;return s.current=!1,f.preventDefault(),f.stopPropagation(),i.goToOption(S.Last);case y.PageDown:return s.current=!1,f.preventDefault(),f.stopPropagation(),i.goToOption(S.Last);case y.Escape:return s.current=!1,r.comboboxState!==0?void 0:(f.preventDefault(),r.optionsRef.current&&!r.optionsPropsRef.current.static&&f.stopPropagation(),r.nullable&&r.mode===0&&r.value===null&&L(),i.closeCombobox());case y.Tab:if(s.current=!1,r.comboboxState!==0)return;r.mode===0&&i.selectActiveOption(),i.closeCombobox();break}}),H=x(f=>{v==null||v(f),r.nullable&&r.mode===0&&f.target.value===""&&L(),i.openCombobox()}),c=x(()=>{s.current=!1}),T=re(()=>{if(r.labelId)return[r.labelId].join(" ")},[r.labelId]),N=p.useMemo(()=>({open:r.comboboxState===0,disabled:r.disabled}),[r]),ee={ref:C,id:R,role:"combobox",type:O,"aria-controls":(n=r.optionsRef.current)==null?void 0:n.id,"aria-expanded":r.comboboxState===0,"aria-activedescendant":r.activeOptionIndex===null||(o=r.options[r.activeOptionIndex])==null?void 0:o.id,"aria-labelledby":T,"aria-autocomplete":"list",defaultValue:(u=(a=e.defaultValue)!=null?a:r.defaultValue!==void 0?d==null?void 0:d(r.defaultValue):null)!=null?u:r.defaultValue,disabled:r.disabled,onCompositionStart:k,onCompositionEnd:_,onKeyDown:w,onChange:H,onBlur:c};return U({ourProps:ee,theirProps:I,slot:N,defaultTag:Ke,name:"Combobox.Input"})}let Be="button";function qe(e,t){var n;let o=B("Combobox.Button"),a=W("Combobox.Button"),u=J(o.buttonRef,t),l=z(),{id:R=`headlessui-combobox-button-${l}`,...v}=e,d=ne(),O=x(m=>{switch(m.key){case y.ArrowDown:return m.preventDefault(),m.stopPropagation(),o.comboboxState===1&&a.openCombobox(),d.nextFrame(()=>{var s;return(s=o.inputRef.current)==null?void 0:s.focus({preventScroll:!0})});case y.ArrowUp:return m.preventDefault(),m.stopPropagation(),o.comboboxState===1&&(a.openCombobox(),d.nextFrame(()=>{o.value||a.goToOption(S.Last)})),d.nextFrame(()=>{var s;return(s=o.inputRef.current)==null?void 0:s.focus({preventScroll:!0})});case y.Escape:return o.comboboxState!==0?void 0:(m.preventDefault(),o.optionsRef.current&&!o.optionsPropsRef.current.static&&m.stopPropagation(),a.closeCombobox(),d.nextFrame(()=>{var s;return(s=o.inputRef.current)==null?void 0:s.focus({preventScroll:!0})}));default:return}}),I=x(m=>{if(he(m.currentTarget))return m.preventDefault();o.comboboxState===0?a.closeCombobox():(m.preventDefault(),a.openCombobox()),d.nextFrame(()=>{var s;return(s=o.inputRef.current)==null?void 0:s.focus({preventScroll:!0})})}),r=re(()=>{if(o.labelId)return[o.labelId,R].join(" ")},[o.labelId,R]),i=p.useMemo(()=>({open:o.comboboxState===0,disabled:o.disabled,value:o.value}),[o]),C={ref:u,id:R,type:Te(e,o.buttonRef),tabIndex:-1,"aria-haspopup":"listbox","aria-controls":(n=o.optionsRef.current)==null?void 0:n.id,"aria-expanded":o.comboboxState===0,"aria-labelledby":r,disabled:o.disabled,onClick:I,onKeyDown:O};return U({ourProps:C,theirProps:v,slot:i,defaultTag:Be,name:"Combobox.Button"})}let He="label";function je(e,t){let n=z(),{id:o=`headlessui-combobox-label-${n}`,...a}=e,u=B("Combobox.Label"),l=W("Combobox.Label"),R=J(u.labelRef,t);M(()=>l.registerLabel(o),[o]);let v=x(()=>{var O;return(O=u.inputRef.current)==null?void 0:O.focus({preventScroll:!0})}),d=p.useMemo(()=>({open:u.comboboxState===0,disabled:u.disabled}),[u]);return U({ourProps:{ref:R,id:o,onClick:v},theirProps:a,slot:d,defaultTag:He,name:"Combobox.Label"})}let Ge="ul",Je=ue.RenderStrategy|ue.Static;function ze(e,t){let n=z(),{id:o=`headlessui-combobox-options-${n}`,hold:a=!1,...u}=e,l=B("Combobox.Options"),R=J(l.optionsRef,t),v=Re(),d=(()=>v!==null?(v&Y.Open)===Y.Open:l.comboboxState===0)();M(()=>{var i;l.optionsPropsRef.current.static=(i=e.static)!=null?i:!1},[l.optionsPropsRef,e.static]),M(()=>{l.optionsPropsRef.current.hold=a},[l.optionsPropsRef,a]),ye({container:l.optionsRef.current,enabled:l.comboboxState===0,accept(i){return i.getAttribute("role")==="option"?NodeFilter.FILTER_REJECT:i.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},walk(i){i.setAttribute("role","none")}});let O=re(()=>{var i,C;return(C=l.labelId)!=null?C:(i=l.buttonRef.current)==null?void 0:i.id},[l.labelId,l.buttonRef.current]),I=p.useMemo(()=>({open:l.comboboxState===0}),[l]),r={"aria-labelledby":O,role:"listbox","aria-multiselectable":l.mode===1?!0:void 0,id:o,ref:R};return U({ourProps:r,theirProps:u,slot:I,defaultTag:Ge,features:Je,visible:d,name:"Combobox.Options"})}let We="li";function Xe(e,t){var n,o;let a=z(),{id:u=`headlessui-combobox-option-${a}`,disabled:l=!1,value:R,...v}=e,d=B("Combobox.Option"),O=W("Combobox.Option"),I=d.activeOptionIndex!==null?d.options[d.activeOptionIndex].id===u:!1,r=d.isSelected(R),i=p.useRef(null),C=se({disabled:l,value:R,domRef:i,textValue:(o=(n=i.current)==null?void 0:n.textContent)==null?void 0:o.toLowerCase()}),m=J(t,i),s=x(()=>O.selectOption(u));M(()=>O.registerOption(u,C),[C,u]);let $=p.useRef(!d.__demoMode);M(()=>{if(!d.__demoMode)return;let c=ce();return c.requestAnimationFrame(()=>{$.current=!0}),c.dispose},[]),M(()=>{if(d.comboboxState!==0||!I||!$.current||d.activationTrigger===0)return;let c=ce();return c.requestAnimationFrame(()=>{var T,N;(N=(T=i.current)==null?void 0:T.scrollIntoView)==null||N.call(T,{block:"nearest"})}),c.dispose},[i,I,d.comboboxState,d.activationTrigger,d.activeOptionIndex]);let L=x(c=>{if(l)return c.preventDefault();s(),d.mode===0&&O.closeCombobox(),De()||requestAnimationFrame(()=>{var T;return(T=d.inputRef.current)==null?void 0:T.focus()})}),q=x(()=>{if(l)return O.goToOption(S.Nothing);O.goToOption(S.Specific,u)}),D=$e(),k=x(c=>D.update(c)),_=x(c=>{D.wasMoved(c)&&(l||I||O.goToOption(S.Specific,u,0))}),w=x(c=>{D.wasMoved(c)&&(l||I&&(d.optionsPropsRef.current.hold||O.goToOption(S.Nothing)))}),H=p.useMemo(()=>({active:I,selected:r,disabled:l}),[I,r,l]);return U({ourProps:{id:u,ref:m,role:"option",tabIndex:l===!0?void 0:-1,"aria-disabled":l===!0?!0:void 0,"aria-selected":r,disabled:void 0,onClick:L,onFocus:q,onPointerEnter:k,onMouseEnter:k,onPointerMove:_,onMouseMove:_,onPointerLeave:w,onMouseLeave:w},theirProps:v,slot:H,defaultTag:We,name:"Combobox.Option"})}let Ze=K(Ve),Qe=K(qe),Ye=K(Ue),eo=K(je),oo=K(ze),to=K(Xe),co=Object.assign(Ze,{Input:Ye,Button:Qe,Label:eo,Options:oo,Option:to});export{co as q};
//# sourceMappingURL=combobox-b10c8063.js.map
