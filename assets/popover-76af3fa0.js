import{r as u,R as I}from"./index-37ba2b57.js";import{S as J,D as z,y as W,T as me,s as ie,o as E,c as Pe,u as H,d as q,X as A,C as ce,l as be}from"./open-closed-452e92a4.js";import{n as re,f as oe,h as Se,I as K,c as ee,p as te,O as G,M as N,a as ye,T as Ee,o as L,r as pe,e as ge,N as ne}from"./use-owner-127f86a6.js";import{s as $e}from"./use-resolve-button-type-39f07965.js";import{a as Ie,j as he,E as Te,n as de,y as xe,s as _}from"./use-root-containers-1a00c623.js";var Ce=(e=>(e[e.Open=0]="Open",e[e.Closed=1]="Closed",e))(Ce||{}),we=(e=>(e[e.TogglePopover=0]="TogglePopover",e[e.ClosePopover=1]="ClosePopover",e[e.SetButton=2]="SetButton",e[e.SetButtonId=3]="SetButtonId",e[e.SetPanel=4]="SetPanel",e[e.SetPanelId=5]="SetPanelId",e))(we||{});let Me={0:e=>{let o={...e,popoverState:H(e.popoverState,{0:1,1:0})};return o.popoverState===0&&(o.__demoMode=!1),o},1(e){return e.popoverState===1?e:{...e,popoverState:1}},2(e,o){return e.button===o.button?e:{...e,button:o.button}},3(e,o){return e.buttonId===o.buttonId?e:{...e,buttonId:o.buttonId}},4(e,o){return e.panel===o.panel?e:{...e,panel:o.panel}},5(e,o){return e.panelId===o.panelId?e:{...e,panelId:o.panelId}}},le=u.createContext(null);le.displayName="PopoverContext";function Q(e){let o=u.useContext(le);if(o===null){let f=new Error(`<${e} /> is missing a parent <Popover /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(f,Q),f}return o}let ue=u.createContext(null);ue.displayName="PopoverAPIContext";function ae(e){let o=u.useContext(ue);if(o===null){let f=new Error(`<${e} /> is missing a parent <Popover /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(f,ae),f}return o}let se=u.createContext(null);se.displayName="PopoverGroupContext";function ve(){return u.useContext(se)}let Z=u.createContext(null);Z.displayName="PopoverPanelContext";function Oe(){return u.useContext(Z)}function ke(e,o){return H(o.type,Me,e,o)}let Fe="div";function Re(e,o){var f;let{__demoMode:g=!1,...T}=e,l=u.useRef(null),t=W(o,me(s=>{l.current=s})),m=u.useRef([]),P=u.useReducer(ke,{__demoMode:g,popoverState:g?0:1,buttons:m,button:null,buttonId:null,panel:null,panelId:null,beforePanelSentinel:u.createRef(),afterPanelSentinel:u.createRef()}),[{popoverState:y,button:c,buttonId:$,panel:r,panelId:R,beforePanelSentinel:C,afterPanelSentinel:S},a]=P,b=re((f=l.current)!=null?f:c),x=u.useMemo(()=>{if(!c||!r)return!1;for(let Y of document.querySelectorAll("body > *"))if(Number(Y==null?void 0:Y.contains(c))^Number(Y==null?void 0:Y.contains(r)))return!0;let s=oe(),w=s.indexOf(c),V=(w+s.length-1)%s.length,j=(w+1)%s.length,X=s[V],fe=s[j];return!r.contains(X)&&!r.contains(fe)},[c,r]),M=ie($),O=ie(R),B=u.useMemo(()=>({buttonId:M,panelId:O,close:()=>a({type:1})}),[M,O,a]),k=ve(),i=k==null?void 0:k.registerPopover,h=E(()=>{var s;return(s=k==null?void 0:k.isFocusWithinPopoverGroup())!=null?s:(b==null?void 0:b.activeElement)&&((c==null?void 0:c.contains(b.activeElement))||(r==null?void 0:r.contains(b.activeElement)))});u.useEffect(()=>i==null?void 0:i(B),[i,B]);let[p,F]=Ie(),n=he({mainTreeNodeRef:k==null?void 0:k.mainTreeNodeRef,portals:p,defaultContainers:[c,r]});Te(b==null?void 0:b.defaultView,"focus",s=>{var w,V,j,X;s.target!==window&&s.target instanceof HTMLElement&&y===0&&(h()||c&&r&&(n.contains(s.target)||(V=(w=C.current)==null?void 0:w.contains)!=null&&V.call(w,s.target)||(X=(j=S.current)==null?void 0:j.contains)!=null&&X.call(j,s.target)||a({type:1})))},!0),Se(n.resolveContainers,(s,w)=>{a({type:1}),ye(w,Ee.Loose)||(s.preventDefault(),c==null||c.focus())},y===0);let d=E(s=>{a({type:1});let w=(()=>s?s instanceof HTMLElement?s:"current"in s&&s.current instanceof HTMLElement?s.current:c:c)();w==null||w.focus()}),v=u.useMemo(()=>({close:d,isPortalled:x}),[d,x]),D=u.useMemo(()=>({open:y===0,close:d}),[y,d]),U={ref:t};return I.createElement(Z.Provider,{value:null},I.createElement(le.Provider,{value:P},I.createElement(ue.Provider,{value:v},I.createElement(Pe,{value:H(y,{0:q.Open,1:q.Closed})},I.createElement(F,null,A({ourProps:U,theirProps:T,slot:D,defaultTag:Fe,name:"Popover"}),I.createElement(n.MainTreeNode,null))))))}let Be="button";function De(e,o){let f=K(),{id:g=`headlessui-popover-button-${f}`,...T}=e,[l,t]=Q("Popover.Button"),{isPortalled:m}=ae("Popover.Button"),P=u.useRef(null),y=`headlessui-focus-sentinel-${K()}`,c=ve(),$=c==null?void 0:c.closeOthers,r=Oe()!==null;u.useEffect(()=>{if(!r)return t({type:3,buttonId:g}),()=>{t({type:3,buttonId:null})}},[r,g,t]);let[R]=u.useState(()=>Symbol()),C=W(P,o,r?null:n=>{if(n)l.buttons.current.push(R);else{let d=l.buttons.current.indexOf(R);d!==-1&&l.buttons.current.splice(d,1)}l.buttons.current.length>1&&console.warn("You are already using a <Popover.Button /> but only 1 <Popover.Button /> is supported."),n&&t({type:2,button:n})}),S=W(P,o),a=re(P),b=E(n=>{var d,v,D;if(r){if(l.popoverState===1)return;switch(n.key){case L.Space:case L.Enter:n.preventDefault(),(v=(d=n.target).click)==null||v.call(d),t({type:1}),(D=l.button)==null||D.focus();break}}else switch(n.key){case L.Space:case L.Enter:n.preventDefault(),n.stopPropagation(),l.popoverState===1&&($==null||$(l.buttonId)),t({type:0});break;case L.Escape:if(l.popoverState!==0)return $==null?void 0:$(l.buttonId);if(!P.current||a!=null&&a.activeElement&&!P.current.contains(a.activeElement))return;n.preventDefault(),n.stopPropagation(),t({type:1});break}}),x=E(n=>{r||n.key===L.Space&&n.preventDefault()}),M=E(n=>{var d,v;pe(n.currentTarget)||e.disabled||(r?(t({type:1}),(d=l.button)==null||d.focus()):(n.preventDefault(),n.stopPropagation(),l.popoverState===1&&($==null||$(l.buttonId)),t({type:0}),(v=l.button)==null||v.focus()))}),O=E(n=>{n.preventDefault(),n.stopPropagation()}),B=l.popoverState===0,k=u.useMemo(()=>({open:B}),[B]),i=$e(e,P),h=r?{ref:S,type:i,onKeyDown:b,onClick:M}:{ref:C,id:l.buttonId,type:i,"aria-expanded":l.popoverState===0,"aria-controls":l.panel?l.panelId:void 0,onKeyDown:b,onKeyUp:x,onClick:M,onMouseDown:O},p=de(),F=E(()=>{let n=l.panel;if(!n)return;function d(){H(p.current,{[_.Forwards]:()=>G(n,N.First),[_.Backwards]:()=>G(n,N.Last)})===ne.Error&&G(oe().filter(v=>v.dataset.headlessuiFocusGuard!=="true"),H(p.current,{[_.Forwards]:N.Next,[_.Backwards]:N.Previous}),{relativeTo:l.button})}d()});return I.createElement(I.Fragment,null,A({ourProps:h,theirProps:T,slot:k,defaultTag:Be,name:"Popover.Button"}),B&&!r&&m&&I.createElement(ee,{id:y,features:te.Focusable,"data-headlessui-focus-guard":!0,as:"button",type:"button",onFocus:F}))}let Ne="div",_e=J.RenderStrategy|J.Static;function Le(e,o){let f=K(),{id:g=`headlessui-popover-overlay-${f}`,...T}=e,[{popoverState:l},t]=Q("Popover.Overlay"),m=W(o),P=ce(),y=(()=>P!==null?(P&q.Open)===q.Open:l===0)(),c=E(r=>{if(pe(r.currentTarget))return r.preventDefault();t({type:1})}),$=u.useMemo(()=>({open:l===0}),[l]);return A({ourProps:{ref:m,id:g,"aria-hidden":!0,onClick:c},theirProps:T,slot:$,defaultTag:Ne,features:_e,visible:y,name:"Popover.Overlay"})}let Ge="div",He=J.RenderStrategy|J.Static;function Ke(e,o){let f=K(),{id:g=`headlessui-popover-panel-${f}`,focus:T=!1,...l}=e,[t,m]=Q("Popover.Panel"),{close:P,isPortalled:y}=ae("Popover.Panel"),c=`headlessui-focus-sentinel-before-${K()}`,$=`headlessui-focus-sentinel-after-${K()}`,r=u.useRef(null),R=W(r,o,i=>{m({type:4,panel:i})}),C=re(r);be(()=>(m({type:5,panelId:g}),()=>{m({type:5,panelId:null})}),[g,m]);let S=ce(),a=(()=>S!==null?(S&q.Open)===q.Open:t.popoverState===0)(),b=E(i=>{var h;switch(i.key){case L.Escape:if(t.popoverState!==0||!r.current||C!=null&&C.activeElement&&!r.current.contains(C.activeElement))return;i.preventDefault(),i.stopPropagation(),m({type:1}),(h=t.button)==null||h.focus();break}});u.useEffect(()=>{var i;e.static||t.popoverState===1&&((i=e.unmount)==null||i)&&m({type:4,panel:null})},[t.popoverState,e.unmount,e.static,m]),u.useEffect(()=>{if(t.__demoMode||!T||t.popoverState!==0||!r.current)return;let i=C==null?void 0:C.activeElement;r.current.contains(i)||G(r.current,N.First)},[t.__demoMode,T,r,t.popoverState]);let x=u.useMemo(()=>({open:t.popoverState===0,close:P}),[t,P]),M={ref:R,id:g,onKeyDown:b,onBlur:T&&t.popoverState===0?i=>{var h,p,F,n,d;let v=i.relatedTarget;v&&r.current&&((h=r.current)!=null&&h.contains(v)||(m({type:1}),((F=(p=t.beforePanelSentinel.current)==null?void 0:p.contains)!=null&&F.call(p,v)||(d=(n=t.afterPanelSentinel.current)==null?void 0:n.contains)!=null&&d.call(n,v))&&v.focus({preventScroll:!0})))}:void 0,tabIndex:-1},O=de(),B=E(()=>{let i=r.current;if(!i)return;function h(){H(O.current,{[_.Forwards]:()=>{var p;G(i,N.First)===ne.Error&&((p=t.afterPanelSentinel.current)==null||p.focus())},[_.Backwards]:()=>{var p;(p=t.button)==null||p.focus({preventScroll:!0})}})}h()}),k=E(()=>{let i=r.current;if(!i)return;function h(){H(O.current,{[_.Forwards]:()=>{var p;if(!t.button)return;let F=oe(),n=F.indexOf(t.button),d=F.slice(0,n+1),v=[...F.slice(n+1),...d];for(let D of v.slice())if(D.dataset.headlessuiFocusGuard==="true"||(p=t.panel)!=null&&p.contains(D)){let U=v.indexOf(D);U!==-1&&v.splice(U,1)}G(v,N.First,{sorted:!1})},[_.Backwards]:()=>{var p;G(i,N.Previous)===ne.Error&&((p=t.button)==null||p.focus())}})}h()});return I.createElement(Z.Provider,{value:g},a&&y&&I.createElement(ee,{id:c,ref:t.beforePanelSentinel,features:te.Focusable,"data-headlessui-focus-guard":!0,as:"button",type:"button",onFocus:B}),A({ourProps:M,theirProps:l,slot:x,defaultTag:Ge,features:He,visible:a,name:"Popover.Panel"}),a&&y&&I.createElement(ee,{id:$,ref:t.afterPanelSentinel,features:te.Focusable,"data-headlessui-focus-guard":!0,as:"button",type:"button",onFocus:k}))}let We="div";function qe(e,o){let f=u.useRef(null),g=W(f,o),[T,l]=u.useState([]),t=xe(),m=E(S=>{l(a=>{let b=a.indexOf(S);if(b!==-1){let x=a.slice();return x.splice(b,1),x}return a})}),P=E(S=>(l(a=>[...a,S]),()=>m(S))),y=E(()=>{var S;let a=ge(f);if(!a)return!1;let b=a.activeElement;return(S=f.current)!=null&&S.contains(b)?!0:T.some(x=>{var M,O;return((M=a.getElementById(x.buttonId.current))==null?void 0:M.contains(b))||((O=a.getElementById(x.panelId.current))==null?void 0:O.contains(b))})}),c=E(S=>{for(let a of T)a.buttonId.current!==S&&a.close()}),$=u.useMemo(()=>({registerPopover:P,unregisterPopover:m,isFocusWithinPopoverGroup:y,closeOthers:c,mainTreeNodeRef:t.mainTreeNodeRef}),[P,m,y,c,t.mainTreeNodeRef]),r=u.useMemo(()=>({}),[]),R=e,C={ref:g};return I.createElement(se.Provider,{value:$},A({ourProps:C,theirProps:R,slot:r,defaultTag:We,name:"Popover.Group"}),I.createElement(t.MainTreeNode,null))}let je=z(Re),ze=z(De),Ae=z(Le),Ue=z(Ke),Ve=z(qe),et=Object.assign(je,{Button:ze,Overlay:Ae,Panel:Ue,Group:Ve});export{et as k};
//# sourceMappingURL=popover-76af3fa0.js.map
