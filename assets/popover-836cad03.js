import{r as u,R as T}from"./index-ec8b93d8.js";import{S as J,D as z,y as H,T as Pe,s as ie,b as g,c as be,u as A,d as W,X as j,C as pe,l as me}from"./open-closed-50e7a81e.js";import{f as re,H as Se,I as K,c as ee,p as te,O as G,M as R,h as ye,T as Ee,o as L,r as ce,e as ge,N as ne}from"./keyboard-c534a18f.js";import{s as $e}from"./use-resolve-button-type-5514e10c.js";import{n as oe,a as Ie,p as he,E as Te,b as de,s as _}from"./use-root-containers-cd4bc64b.js";var xe=(e=>(e[e.Open=0]="Open",e[e.Closed=1]="Closed",e))(xe||{}),we=(e=>(e[e.TogglePopover=0]="TogglePopover",e[e.ClosePopover=1]="ClosePopover",e[e.SetButton=2]="SetButton",e[e.SetButtonId=3]="SetButtonId",e[e.SetPanel=4]="SetPanel",e[e.SetPanelId=5]="SetPanelId",e))(we||{});let Fe={[0]:e=>{let o={...e,popoverState:A(e.popoverState,{[0]:1,[1]:0})};return o.popoverState===0&&(o.__demoMode=!1),o},[1](e){return e.popoverState===1?e:{...e,popoverState:1}},[2](e,o){return e.button===o.button?e:{...e,button:o.button}},[3](e,o){return e.buttonId===o.buttonId?e:{...e,buttonId:o.buttonId}},[4](e,o){return e.panel===o.panel?e:{...e,panel:o.panel}},[5](e,o){return e.panelId===o.panelId?e:{...e,panelId:o.panelId}}},le=u.createContext(null);le.displayName="PopoverContext";function Q(e){let o=u.useContext(le);if(o===null){let b=new Error(`<${e} /> is missing a parent <Popover /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(b,Q),b}return o}let ue=u.createContext(null);ue.displayName="PopoverAPIContext";function ae(e){let o=u.useContext(ue);if(o===null){let b=new Error(`<${e} /> is missing a parent <Popover /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(b,ae),b}return o}let se=u.createContext(null);se.displayName="PopoverGroupContext";function ve(){return u.useContext(se)}let Z=u.createContext(null);Z.displayName="PopoverPanelContext";function Me(){return u.useContext(Z)}function Oe(e,o){return A(o.type,Fe,e,o)}let ke="div";function Ce(e,o){var b;let{__demoMode:$=!1,...x}=e,l=u.useRef(null),t=H(o,Pe(a=>{l.current=a})),S=u.useRef([]),m=u.useReducer(Oe,{__demoMode:$,popoverState:$?0:1,buttons:S,button:null,buttonId:null,panel:null,panelId:null,beforePanelSentinel:u.createRef(),afterPanelSentinel:u.createRef()}),[{popoverState:E,button:i,buttonId:I,panel:r,panelId:k,beforePanelSentinel:P,afterPanelSentinel:p},c]=m,y=oe((b=l.current)!=null?b:i),O=u.useMemo(()=>{if(!i||!r)return!1;for(let Y of document.querySelectorAll("body > *"))if(Number(Y==null?void 0:Y.contains(i))^Number(Y==null?void 0:Y.contains(r)))return!0;let a=re(),w=a.indexOf(i),V=(w+a.length-1)%a.length,q=(w+1)%a.length,X=a[V],fe=a[q];return!r.contains(X)&&!r.contains(fe)},[i,r]),F=ie(I),N=ie(k),C=u.useMemo(()=>({buttonId:F,panelId:N,close:()=>c({type:1})}),[F,N,c]),B=ve(),s=B==null?void 0:B.registerPopover,h=g(()=>{var a;return(a=B==null?void 0:B.isFocusWithinPopoverGroup())!=null?a:(y==null?void 0:y.activeElement)&&((i==null?void 0:i.contains(y.activeElement))||(r==null?void 0:r.contains(y.activeElement)))});u.useEffect(()=>s==null?void 0:s(C),[s,C]);let[d,M]=Ie(),n=he({portals:d,defaultContainers:[i,r]});Te(y==null?void 0:y.defaultView,"focus",a=>{var w,V,q,X;a.target!==window&&a.target instanceof HTMLElement&&E===0&&(h()||i&&r&&(n.contains(a.target)||(V=(w=P.current)==null?void 0:w.contains)!=null&&V.call(w,a.target)||(X=(q=p.current)==null?void 0:q.contains)!=null&&X.call(q,a.target)||c({type:1})))},!0),Se(n.resolveContainers,(a,w)=>{c({type:1}),ye(w,Ee.Loose)||(a.preventDefault(),i==null||i.focus())},E===0);let v=g(a=>{c({type:1});let w=(()=>a?a instanceof HTMLElement?a:"current"in a&&a.current instanceof HTMLElement?a.current:i:i)();w==null||w.focus()}),f=u.useMemo(()=>({close:v,isPortalled:O}),[v,O]),D=u.useMemo(()=>({open:E===0,close:v}),[E,v]),U={ref:t};return T.createElement(Z.Provider,{value:null},T.createElement(le.Provider,{value:m},T.createElement(ue.Provider,{value:f},T.createElement(be,{value:A(E,{[0]:W.Open,[1]:W.Closed})},T.createElement(M,null,j({ourProps:U,theirProps:x,slot:D,defaultTag:ke,name:"Popover"}),T.createElement(n.MainTreeNode,null))))))}let Be="button";function De(e,o){let b=K(),{id:$=`headlessui-popover-button-${b}`,...x}=e,[l,t]=Q("Popover.Button"),{isPortalled:S}=ae("Popover.Button"),m=u.useRef(null),E=`headlessui-focus-sentinel-${K()}`,i=ve(),I=i==null?void 0:i.closeOthers,r=Me()!==null;u.useEffect(()=>{if(!r)return t({type:3,buttonId:$}),()=>{t({type:3,buttonId:null})}},[r,$,t]);let[k]=u.useState(()=>Symbol()),P=H(m,o,r?null:n=>{if(n)l.buttons.current.push(k);else{let v=l.buttons.current.indexOf(k);v!==-1&&l.buttons.current.splice(v,1)}l.buttons.current.length>1&&console.warn("You are already using a <Popover.Button /> but only 1 <Popover.Button /> is supported."),n&&t({type:2,button:n})}),p=H(m,o),c=oe(m),y=g(n=>{var v,f,D;if(r){if(l.popoverState===1)return;switch(n.key){case L.Space:case L.Enter:n.preventDefault(),(f=(v=n.target).click)==null||f.call(v),t({type:1}),(D=l.button)==null||D.focus();break}}else switch(n.key){case L.Space:case L.Enter:n.preventDefault(),n.stopPropagation(),l.popoverState===1&&(I==null||I(l.buttonId)),t({type:0});break;case L.Escape:if(l.popoverState!==0)return I==null?void 0:I(l.buttonId);if(!m.current||c!=null&&c.activeElement&&!m.current.contains(c.activeElement))return;n.preventDefault(),n.stopPropagation(),t({type:1});break}}),O=g(n=>{r||n.key===L.Space&&n.preventDefault()}),F=g(n=>{var v,f;ce(n.currentTarget)||e.disabled||(r?(t({type:1}),(v=l.button)==null||v.focus()):(n.preventDefault(),n.stopPropagation(),l.popoverState===1&&(I==null||I(l.buttonId)),t({type:0}),(f=l.button)==null||f.focus()))}),N=g(n=>{n.preventDefault(),n.stopPropagation()}),C=l.popoverState===0,B=u.useMemo(()=>({open:C}),[C]),s=$e(e,m),h=r?{ref:p,type:s,onKeyDown:y,onClick:F}:{ref:P,id:l.buttonId,type:s,"aria-expanded":e.disabled?void 0:l.popoverState===0,"aria-controls":l.panel?l.panelId:void 0,onKeyDown:y,onKeyUp:O,onClick:F,onMouseDown:N},d=de(),M=g(()=>{let n=l.panel;if(!n)return;function v(){A(d.current,{[_.Forwards]:()=>G(n,R.First),[_.Backwards]:()=>G(n,R.Last)})===ne.Error&&G(re().filter(f=>f.dataset.headlessuiFocusGuard!=="true"),A(d.current,{[_.Forwards]:R.Next,[_.Backwards]:R.Previous}),{relativeTo:l.button})}v()});return T.createElement(T.Fragment,null,j({ourProps:h,theirProps:x,slot:B,defaultTag:Be,name:"Popover.Button"}),C&&!r&&S&&T.createElement(ee,{id:E,features:te.Focusable,"data-headlessui-focus-guard":!0,as:"button",type:"button",onFocus:M}))}let Re="div",_e=J.RenderStrategy|J.Static;function Ne(e,o){let b=K(),{id:$=`headlessui-popover-overlay-${b}`,...x}=e,[{popoverState:l},t]=Q("Popover.Overlay"),S=H(o),m=pe(),E=(()=>m!==null?(m&W.Open)===W.Open:l===0)(),i=g(r=>{if(ce(r.currentTarget))return r.preventDefault();t({type:1})}),I=u.useMemo(()=>({open:l===0}),[l]);return j({ourProps:{ref:S,id:$,"aria-hidden":!0,onClick:i},theirProps:x,slot:I,defaultTag:Re,features:_e,visible:E,name:"Popover.Overlay"})}let Le="div",Ge=J.RenderStrategy|J.Static;function Ae(e,o){let b=K(),{id:$=`headlessui-popover-panel-${b}`,focus:x=!1,...l}=e,[t,S]=Q("Popover.Panel"),{close:m,isPortalled:E}=ae("Popover.Panel"),i=`headlessui-focus-sentinel-before-${K()}`,I=`headlessui-focus-sentinel-after-${K()}`,r=u.useRef(null),k=H(r,o,s=>{S({type:4,panel:s})}),P=oe(r);me(()=>(S({type:5,panelId:$}),()=>{S({type:5,panelId:null})}),[$,S]);let p=pe(),c=(()=>p!==null?(p&W.Open)===W.Open:t.popoverState===0)(),y=g(s=>{var h;switch(s.key){case L.Escape:if(t.popoverState!==0||!r.current||P!=null&&P.activeElement&&!r.current.contains(P.activeElement))return;s.preventDefault(),s.stopPropagation(),S({type:1}),(h=t.button)==null||h.focus();break}});u.useEffect(()=>{var s;e.static||t.popoverState===1&&((s=e.unmount)==null||s)&&S({type:4,panel:null})},[t.popoverState,e.unmount,e.static,S]),u.useEffect(()=>{if(t.__demoMode||!x||t.popoverState!==0||!r.current)return;let s=P==null?void 0:P.activeElement;r.current.contains(s)||G(r.current,R.First)},[t.__demoMode,x,r,t.popoverState]);let O=u.useMemo(()=>({open:t.popoverState===0,close:m}),[t,m]),F={ref:k,id:$,onKeyDown:y,onBlur:x&&t.popoverState===0?s=>{var h,d,M,n,v;let f=s.relatedTarget;f&&r.current&&((h=r.current)!=null&&h.contains(f)||(S({type:1}),((M=(d=t.beforePanelSentinel.current)==null?void 0:d.contains)!=null&&M.call(d,f)||(v=(n=t.afterPanelSentinel.current)==null?void 0:n.contains)!=null&&v.call(n,f))&&f.focus({preventScroll:!0})))}:void 0,tabIndex:-1},N=de(),C=g(()=>{let s=r.current;if(!s)return;function h(){A(N.current,{[_.Forwards]:()=>{var d;G(s,R.First)===ne.Error&&((d=t.afterPanelSentinel.current)==null||d.focus())},[_.Backwards]:()=>{var d;(d=t.button)==null||d.focus({preventScroll:!0})}})}h()}),B=g(()=>{let s=r.current;if(!s)return;function h(){A(N.current,{[_.Forwards]:()=>{var d;if(!t.button)return;let M=re(),n=M.indexOf(t.button),v=M.slice(0,n+1),f=[...M.slice(n+1),...v];for(let D of f.slice())if(D.dataset.headlessuiFocusGuard==="true"||(d=t.panel)!=null&&d.contains(D)){let U=f.indexOf(D);U!==-1&&f.splice(U,1)}G(f,R.First,{sorted:!1})},[_.Backwards]:()=>{var d;G(s,R.Previous)===ne.Error&&((d=t.button)==null||d.focus())}})}h()});return T.createElement(Z.Provider,{value:$},c&&E&&T.createElement(ee,{id:i,ref:t.beforePanelSentinel,features:te.Focusable,"data-headlessui-focus-guard":!0,as:"button",type:"button",onFocus:C}),j({ourProps:F,theirProps:l,slot:O,defaultTag:Le,features:Ge,visible:c,name:"Popover.Panel"}),c&&E&&T.createElement(ee,{id:I,ref:t.afterPanelSentinel,features:te.Focusable,"data-headlessui-focus-guard":!0,as:"button",type:"button",onFocus:B}))}let Ke="div";function He(e,o){let b=u.useRef(null),$=H(b,o),[x,l]=u.useState([]),t=g(P=>{l(p=>{let c=p.indexOf(P);if(c!==-1){let y=p.slice();return y.splice(c,1),y}return p})}),S=g(P=>(l(p=>[...p,P]),()=>t(P))),m=g(()=>{var P;let p=ge(b);if(!p)return!1;let c=p.activeElement;return(P=b.current)!=null&&P.contains(c)?!0:x.some(y=>{var O,F;return((O=p.getElementById(y.buttonId.current))==null?void 0:O.contains(c))||((F=p.getElementById(y.panelId.current))==null?void 0:F.contains(c))})}),E=g(P=>{for(let p of x)p.buttonId.current!==P&&p.close()}),i=u.useMemo(()=>({registerPopover:S,unregisterPopover:t,isFocusWithinPopoverGroup:m,closeOthers:E}),[S,t,m,E]),I=u.useMemo(()=>({}),[]),r=e,k={ref:$};return T.createElement(se.Provider,{value:i},j({ourProps:k,theirProps:r,slot:I,defaultTag:Ke,name:"Popover.Group"}))}let We=z(Ce),qe=z(De),ze=z(Ne),je=z(Ae),Ue=z(He),Ze=Object.assign(We,{Button:qe,Overlay:ze,Panel:je,Group:Ue});export{Ze as k};
//# sourceMappingURL=popover-836cad03.js.map
